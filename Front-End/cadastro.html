<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Cadastro Pessoal</title>

    <link rel="stylesheet" href="cadastro.css" />
  </head>
  <body>
    <div class="container">
      <h2>CADASTRO PESSOAL</h2>

      <div class="radio-group">
        <label><input type="radio" name="tipo" value="aluno" />Aluno</label>
        <label>
          <input type="radio" name="tipo" value="professor" />Professor
        </label>
      </div>

      <div class="form">
        <div class="form-left">
          <label>Nome Completo:</label>
          <input type="text" id="nome" />

          <label>Data de Nascimento:</label>
          <input type="date" id="data_nascimento" />

          <label>Contato:</label>
          <input type="text" id="contato" />

          <label>CPF:</label>
          <input type="text" id="cpf" />

          <label>RG:</label>
          <input type="text" id="rg" />

          <label>Cidade:</label>
          <input type="text" id="cidade" />

          <label>Endereço:</label>
          <input type="text" id="endereco" />

          <label>Estado Civil:</label>
          <input type="text" id="estado_civil" />

          <label>Sexo:</label>
          <input type="text" id="sexo" />

          <label>Nome do pai:</label>
          <input type="text" id="nome_pai" />

          <label>Nome da mãe:</label>
          <input type="text" id="nome_mae" />

          <label>Senha:</label>
          <input type="password" id="senha" />
        </div>
      </div>
      <div>
        <button class="btnCadastrar" onclick="cadastrarUsuario()">
          CADASTRAR
        </button>

        <script>
          async function cadastrarUsuario() {
            const tipoRadio = document.querySelector(
              "input[name='tipo']:checked"
            );
            if (!tipoRadio) {
              alert("Por favor, selecione o tipo de usuário.");
              return;
            }

            const dados = {
              tipo: tipoRadio.value,
              nome: document.getElementById("nome").value,
              data_nascimento: document.getElementById("data_nascimento").value,
              contato: document.getElementById("contato").value,
              cpf: document.getElementById("cpf").value,
              rg: document.getElementById("rg").value,
              cidade: document.getElementById("cidade").value,
              endereco: document.getElementById("endereco").value,
              estado_civil: document.getElementById("estado_civil").value,
              sexo: document.getElementById("sexo").value,
              nome_pai: document.getElementById("nome_pai").value,
              nome_mae: document.getElementById("nome_mae").value,
              senha: document.getElementById("senha").value,
            };

            for (const key in dados) {
              if (dados[key] === "") {
                alert(`Por favor, preencha o campo: ${key.replace(/_/g, " ")}`);
                return;
              }
            }

            try {
              const response = await fetch("http://localhost:3000/cadastro", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dados),
              });

              const result = await response.json();
              if (response.status === 200) {
                alert(result.message);
                window.location.href = "login.html";
              } else {
                alert(result.error);
              }
            } catch (error) {
              alert(
                "Erro de conexão com o servidor. Verifique se o backend está rodando na porta 3000."
              );
              console.error("Erro:", error);
            }
          }
        </script>
      </div>
    </div>

    <script>
      const fileInput = document.getElementById("file-input");
      const preview = document.getElementById("preview");

      fileInput.addEventListener("change", function () {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      });
    </script>
  </body>
</html>
